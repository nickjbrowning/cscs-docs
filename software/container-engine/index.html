
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://eth-cscs.github.io/software/container-engine/">
      
      
        <link rel="prev" href="../uenv/">
      
      
        <link rel="next" href="../../services/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Container Engine - CSCS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#container-engine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            

<p>
Work in progress.
</p>

<p>
The information found here is up to date but incomplete. Many pages are still empty or missing.
Please refer to <a href="https://docs.cscs.ch">docs.cscs.ch</a> for documentation missing from this site for the time being.
</p>


          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CSCS Documentation" class="md-header__button md-logo" aria-label="CSCS Documentation" data-md-component="logo">
      
  <img src="../../assets/cscs-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CSCS Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Container Engine
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/eth-cscs/cscs-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CSCS Documentation" class="md-nav__button md-logo" aria-label="CSCS Documentation" data-md-component="logo">
      
  <img src="../../assets/cscs-logo.png" alt="logo">

    </a>
    CSCS Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eth-cscs/cscs-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../alps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Alps
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Alps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/platforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Platforms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/clusters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clusters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alps/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/mlp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Machine Learning Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Machine Learning Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/clariden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    clariden
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/bristen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bristen
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/hpcp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    HPC Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            HPC Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/daint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    daint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/eiger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eiger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../platforms/cwp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Climate and Weather Platform
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Climate and Weather Platform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/santis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    santis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../accounts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Accounts and Projects
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Accounts and Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accounts/ump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Account and Resources Management Tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accounts/waldur/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project and Resources Management Tool
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../access/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Connecting to Alps
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Connecting to Alps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/mfa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi Factor Authentication (MFA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/web/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/ssh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/vscode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Software
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../sciapps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Scientific Applications
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Scientific Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sciapps/cp2k/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CP2K
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sciapps/gromacs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GROMACS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sciapps/lammps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LAMMPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sciapps/namd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NAMD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sciapps/quantumespresso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantum ESPRESSO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sciapps/vasp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VASP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../prgenv/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Programming Environments
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Programming Environments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prgenv/prgenv-gnu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prgenv-gnu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prgenv/prgenv-nvfortran/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prgenv-nvfortran
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prgenv/linalg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linalg
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../communication/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Communication Libraries
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Communication Libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication/cray-mpich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cray MPICH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication/openmpi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenMPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication/nccl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NCCL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication/rccl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RCCL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication/libfabric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    libfabric
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../build-install/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Building and Installing software
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Building and Installing software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Containers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/cpe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cray Programming Environment (CPE)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build-install/pip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python with pip
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../devtools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Debugging and Performance Analysis
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Debugging and Performance Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devtools/linaro-uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linaro uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devtools/linaro-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Linaro performance analysis tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devtools/linaro-ddt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Linaro debugger
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devtools/nvidia-nsight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NVIDIA Nsight
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uenv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Container Engine
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Container Engine
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concept" class="md-nav__link">
    <span class="md-ellipsis">
      Concept
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-edf" class="md-nav__link">
    <span class="md-ellipsis">
      Example EDF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Running the environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-containerized-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Running containerized environments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running containerized environments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-from-batch-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Use from batch scripts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-edf-search-path" class="md-nav__link">
    <span class="md-ellipsis">
      The EDF search path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-management" class="md-nav__link">
    <span class="md-ellipsis">
      Image Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Image Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#image-cache" class="md-nav__link">
    <span class="md-ellipsis">
      Image cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pulling-images-manually" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling images manually
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party-and-private-registries" class="md-nav__link">
    <span class="md-ellipsis">
      Third-party and private registries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Annotations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-native-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing native resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Accessing native resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nvidia-gpus" class="md-nav__link">
    <span class="md-ellipsis">
      NVIDIA GPUs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hpe-slingshot-interconnect" class="md-nav__link">
    <span class="md-ellipsis">
      HPE Slingshot interconnect
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-hooks" class="md-nav__link">
    <span class="md-ellipsis">
      Container Hooks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Container Hooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws-ofi-nccl-hook" class="md-nav__link">
    <span class="md-ellipsis">
      AWS OFI NCCL Hook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-hook" class="md-nav__link">
    <span class="md-ellipsis">
      SSH Hook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nvidia-cuda-mps-hook" class="md-nav__link">
    <span class="md-ellipsis">
      NVIDIA CUDA MPS Hook
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edf-reference" class="md-nav__link">
    <span class="md-ellipsis">
      EDF Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EDF Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#array-or-string-base_environment" class="md-nav__link">
    <span class="md-ellipsis">
      (ARRAY or STRING) base_environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-image" class="md-nav__link">
    <span class="md-ellipsis">
      (STRING) image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-workdir" class="md-nav__link">
    <span class="md-ellipsis">
      (STRING) workdir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bool-entrypoint" class="md-nav__link">
    <span class="md-ellipsis">
      (BOOL) entrypoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bool-writable" class="md-nav__link">
    <span class="md-ellipsis">
      (BOOL) writable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-mounts" class="md-nav__link">
    <span class="md-ellipsis">
      (ARRAY) mounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-env" class="md-nav__link">
    <span class="md-ellipsis">
      (TABLE) env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      (TABLE) annotations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variable-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variable Expansion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relative-paths-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      Relative paths expansion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Known Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Known Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compatibility-with-alpine-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Compatibility with Alpine Linux
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../services/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/firecrest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FirecREST
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../running/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Running Jobs
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Running Jobs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running/slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    slurm
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../storage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Data Management and Storage
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Data Management and Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/filesystems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Systems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/transfer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Transfer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/longterm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Long Term Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/object/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Object Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/internet-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internet Access on Alps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/terminal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the terminal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/gb2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gordon Bell 2025
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../policies/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Policies
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Policies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/regulations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Regulations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/code-of-conduct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UserLab Support Policy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/slack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slack Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../contributing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concept" class="md-nav__link">
    <span class="md-ellipsis">
      Concept
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-edf" class="md-nav__link">
    <span class="md-ellipsis">
      Example EDF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Running the environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-containerized-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Running containerized environments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running containerized environments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-from-batch-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Use from batch scripts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-edf-search-path" class="md-nav__link">
    <span class="md-ellipsis">
      The EDF search path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-management" class="md-nav__link">
    <span class="md-ellipsis">
      Image Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Image Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#image-cache" class="md-nav__link">
    <span class="md-ellipsis">
      Image cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pulling-images-manually" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling images manually
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party-and-private-registries" class="md-nav__link">
    <span class="md-ellipsis">
      Third-party and private registries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Annotations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-native-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing native resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Accessing native resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nvidia-gpus" class="md-nav__link">
    <span class="md-ellipsis">
      NVIDIA GPUs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hpe-slingshot-interconnect" class="md-nav__link">
    <span class="md-ellipsis">
      HPE Slingshot interconnect
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-hooks" class="md-nav__link">
    <span class="md-ellipsis">
      Container Hooks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Container Hooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws-ofi-nccl-hook" class="md-nav__link">
    <span class="md-ellipsis">
      AWS OFI NCCL Hook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-hook" class="md-nav__link">
    <span class="md-ellipsis">
      SSH Hook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nvidia-cuda-mps-hook" class="md-nav__link">
    <span class="md-ellipsis">
      NVIDIA CUDA MPS Hook
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edf-reference" class="md-nav__link">
    <span class="md-ellipsis">
      EDF Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EDF Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#array-or-string-base_environment" class="md-nav__link">
    <span class="md-ellipsis">
      (ARRAY or STRING) base_environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-image" class="md-nav__link">
    <span class="md-ellipsis">
      (STRING) image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-workdir" class="md-nav__link">
    <span class="md-ellipsis">
      (STRING) workdir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bool-entrypoint" class="md-nav__link">
    <span class="md-ellipsis">
      (BOOL) entrypoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bool-writable" class="md-nav__link">
    <span class="md-ellipsis">
      (BOOL) writable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-mounts" class="md-nav__link">
    <span class="md-ellipsis">
      (ARRAY) mounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-env" class="md-nav__link">
    <span class="md-ellipsis">
      (TABLE) env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      (TABLE) annotations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variable-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variable Expansion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relative-paths-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      Relative paths expansion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Known Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Known Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compatibility-with-alpine-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Compatibility with Alpine Linux
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/eth-cscs/cscs-docs/edit/main/docs/software/container-engine.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  


<p><a href="" id="ref-container-engine"></a></p>
<h1 id="container-engine">Container Engine<a class="headerlink" href="#container-engine" title="Permanent link">&para;</a></h1>
<p>The Container Engine (CE) toolset is designed to enable computing jobs to seamlessly run inside Linux application containers, thus providing support for containerized user environments.</p>
<h2 id="concept">Concept<a class="headerlink" href="#concept" title="Permanent link">&para;</a></h2>
<p>Containers effectively encapsulate a software stack; however, to be useful in HPC computing environments, they often require the customization of bind mounts, environment variables, working directories, hooks, plugins, etc. To simplify this process, the Container Engine (CE) toolset supports the specification of user environments through Environment Definition Files.</p>
<p>An Environment Definition File (EDF) is a text file in the <a href="https://toml.io/en/">TOML format</a> that declaratively and prescriptively represents the creation of a computing environment based on a container image. Users can create their own custom environments and share, edit, or build upon already existing environments.</p>
<p>The Container Engine (CE) toolset leverages its tight integration with the Slurm workload manager to parse EDFs directly from the command line or batch script and instantiate containerized user environments seamlessly and transparently.</p>
<p>Through the EDF, container use cases can be abstracted to the point where end users perform their workflows as if they were operating natively on the computing system.</p>
<p><strong>Key Benefits</strong></p>
<ul>
<li><em>Freedom</em>: Container gives users full control of the user space. The user can decide what to install without involving a sysadmin.</li>
<li><em>Reproducibility</em>: Workloads consistently run in the same environment, ensuring uniformity across job experimental runs.</li>
<li><em>Portability</em>: The self-contained nature of containers simplifies the deployment across architecture-compatible HPC systems.</li>
<li><em>Seamless Access to HPC Resources</em>: CE facilitates native access to specialized HPC resources like GPUs, interconnects, and other system-specific tools crucial for performance</li>
</ul>
<h2 id="quick-start">Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">&para;</a></h2>
<p>Let's set up a containerized Ubuntu 24.04 environment using a scratch folder as the working directory.</p>
<h3 id="example-edf">Example EDF<a class="headerlink" href="#example-edf" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;library/ubuntu:24.04&quot;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nv">mounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;/capstor/scratch/cscs/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">:/capstor/scratch/cscs/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">]</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nv">workdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/capstor/scratch/cscs/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p>Note: Ensure that your <code>${USER}</code> environment variable is defined with your actual username.</p>
<p>Save this file as <code>ubuntu.toml</code> file in <code>$HOME/.edf</code> directory (which is the default location of EDF files). A more detailed explanation of each entry for the EDF can be seen in the <a class="autorefs autorefs-internal" title="EDF Reference" href="#edf-reference">EDF reference</a></p>
<h3 id="running-the-environment">Running the environment<a class="headerlink" href="#running-the-environment" title="Permanent link">&para;</a></h3>
<p>Use Slurm in the cluster login node to start the Ubuntu environment that was just defined as follows:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$<span class="w"> </span>srun<span class="w"> </span>--environment<span class="o">=</span>ubuntu<span class="w"> </span>--pty<span class="w"> </span>bash
</span></code></pre></div>
<p>Since the <code>ubuntu.toml</code> file is located in the <a class="autorefs autorefs-internal" title="The EDF search path" href="#the-edf-search-path">EDF search path</a>, the filename can be passed to the option without the file extension.</p>
<div class="admonition example">
<p class="admonition-title">launching a containerized environment</p>
<p>The above terminal snippet demonstrates how to launch a containerized environment using Slurm with the <code>--environment</code> option.
Click on the <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512m-24-168v-64h-64c-13.3 0-24-10.7-24-24s10.7-24 24-24h64v-64c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24h-64v64c0 13.3-10.7 24-24 24s-24-10.7-24-24"/></svg></span> icon for information on each command.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="gp">[daint-ln002]$ </span>srun<span class="w"> </span>--environment<span class="o">=</span>ubuntu<span class="w"> </span>--pty<span class="w"> </span>bash<span class="w">   </span><span class="c1"># (1)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="gp">[nid005333]$ </span><span class="nb">pwd</span><span class="w">                                    </span><span class="c1"># (2)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="go">/capstor/scratch/cscs/&lt;username&gt;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="gp">[nid005333]$ </span>cat<span class="w"> </span>/etc/os-release<span class="w">                    </span><span class="c1"># (3)</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="go">PRETTY_NAME=&quot;Ubuntu 24.04 LTS&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="go">NAME=&quot;Ubuntu&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="go">VERSION_ID=&quot;24.04&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="go">VERSION=&quot;24.04 LTS (Noble Numbat)&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="go">VERSION_CODENAME=noble</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="go">ID=ubuntu</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="go">ID_LIKE=debian</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="go">HOME_URL=&quot;https://www.ubuntu.com/&quot;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="go">SUPPORT_URL=&quot;https://help.ubuntu.com/&quot;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="go">BUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="go">PRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="go">UBUNTU_CODENAME=noble</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="go">LOGO=ubuntu-logo</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="gp">[nid005333]$ </span><span class="nb">exit</span><span class="w">                                  </span><span class="c1"># (4)</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="gp">[daint-ln002]$</span>
</span></code></pre></div>
<ol>
<li>Starting an interactive shell session within the Ubuntu 24.04 container deployed on a compute node using <code>srun --environment=ubuntu --pty bash</code>.</li>
<li>Confirm the working directory inside the container (<code>pwd</code>) and that it is set to the user's scratch folder, as per EDF.</li>
<li>Show the OS version of your container (using <code>cat /etc/os-release</code>) based on Ubuntu 24.04 LTS.</li>
<li>Exiting the container (<code>exit</code>), returning to the login node.</li>
</ol>
<p>Note that the image pull and the container start happen automatically, streamlining the usage of the CE.</p>
</div>
<h2 id="running-containerized-environments">Running containerized environments<a class="headerlink" href="#running-containerized-environments" title="Permanent link">&para;</a></h2>
<p>A job is run in a containerized environment by passing the <code>--environment</code> option to the <code>srun</code> or <code>salloc</code> Slurm commands.
The option takes a file path to the EDF describing the environment in which the job should be executed, for example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>--environment<span class="o">=</span><span class="nv">$SCRATCH</span>/edf/debian.toml<span class="w"> </span>cat<span class="w"> </span>/etc/os-release
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">&quot;Debian GNU/Linux 12 (bookworm)&quot;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;Debian GNU/Linux&quot;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">&quot;12&quot;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="nv">VERSION</span><span class="o">=</span><span class="s2">&quot;12 (bookworm)&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="nv">VERSION_CODENAME</span><span class="o">=</span>bookworm
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="nv">ID</span><span class="o">=</span>debian
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">&quot;https://www.debian.org/&quot;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="nv">SUPPORT_URL</span><span class="o">=</span><span class="s2">&quot;https://www.debian.org/support&quot;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="nv">BUG_REPORT_URL</span><span class="o">=</span><span class="s2">&quot;https://bugs.debian.org/&quot;</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="sb">`</span>--environment<span class="sb">`</span><span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>a<span class="w"> </span>relative<span class="w"> </span>path<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>working<span class="w"> </span>directory<span class="w"> </span><span class="o">(</span>i.e.,<span class="w"> </span>where<span class="w"> </span>the<span class="w"> </span>Slurm<span class="w"> </span><span class="nb">command</span><span class="w"> </span>is<span class="w"> </span>entered<span class="o">)</span>.<span class="w"> </span>A<span class="w"> </span>relative<span class="w"> </span>path<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>prepended<span class="w"> </span>by<span class="w"> </span><span class="sb">`</span>./<span class="sb">`</span>.<span class="w"> </span>For<span class="w"> </span>example:
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>&gt;<span class="w"> </span>ls
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>debian.toml
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>--environment<span class="o">=</span>./debian.toml<span class="w"> </span>cat<span class="w"> </span>/etc/os-release
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">&quot;Debian GNU/Linux 12 (bookworm)&quot;</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;Debian GNU/Linux&quot;</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">&quot;12&quot;</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="nv">VERSION</span><span class="o">=</span><span class="s2">&quot;12 (bookworm)&quot;</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="nv">VERSION_CODENAME</span><span class="o">=</span>bookworm
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="nv">ID</span><span class="o">=</span>debian
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">&quot;https://www.debian.org/&quot;</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="nv">SUPPORT_URL</span><span class="o">=</span><span class="s2">&quot;https://www.debian.org/support&quot;</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="nv">BUG_REPORT_URL</span><span class="o">=</span><span class="s2">&quot;https://bugs.debian.org/&quot;</span>
</span></code></pre></div>
<p>If a file is located in the <a class="autorefs autorefs-internal" title="The EDF search path" href="#the-edf-search-path">EDF search path</a>, the argument to the command line option can be just the environment name, that is the name of the file without the <code>.toml</code> extension, for example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>--environment<span class="o">=</span>debian<span class="w"> </span>cat<span class="w"> </span>/etc/os-release
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">&quot;Debian GNU/Linux 12 (bookworm)&quot;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;Debian GNU/Linux&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">&quot;12&quot;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nv">VERSION</span><span class="o">=</span><span class="s2">&quot;12 (bookworm)&quot;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="nv">VERSION_CODENAME</span><span class="o">=</span>bookworm
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="nv">ID</span><span class="o">=</span>debian
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">&quot;https://www.debian.org/&quot;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="nv">SUPPORT_URL</span><span class="o">=</span><span class="s2">&quot;https://www.debian.org/support&quot;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="nv">BUG_REPORT_URL</span><span class="o">=</span><span class="s2">&quot;https://bugs.debian.org/&quot;</span>
</span></code></pre></div>
<h3 id="use-from-batch-scripts">Use from batch scripts<a class="headerlink" href="#use-from-batch-scripts" title="Permanent link">&para;</a></h3>
<p>In principle, the <code>--environment</code> option can also be used within batch scripts as an <code>#SBATCH</code> option.
It is important to note that in such a case, all the contents of the script are executed within the containerized environment: the CE toolset gives access to the Slurm workload manager within containers via the Slurm hook, see section <a class="autorefs autorefs-internal" href="#container-hooks">Container Hooks</a> (controlled by the <code>ENROOT_SLURM_HOOK</code> environment variable and activated by default on most vClusters). Only with it, calls to Slurm commands (for example <code>srun</code> or <code>scontrol</code>) within the batch script will work.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For the time being, if the script requires to invoke Slurm commands, the recommended approach is to use <code>--environment</code> as part of the commands, for example, when launching job steps the following slurm batch job:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="ch">#!/bin/bash -l</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="c1">#SBATCH --job-name=edf-example</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1">#SBATCH --time=0:01:00</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c1">#SBATCH --nodes=2</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1">#SBATCH --ntasks-per-node=1</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="c1">#SBATCH --partition=&lt;vcluster&gt;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c1">#SBATCH --output=slurm-%x.out</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="c1"># Run job step</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>srun<span class="w"> </span>--environment<span class="o">=</span>debian<span class="w"> </span>cat<span class="w"> </span>/etc/os-release
</span></code></pre></div>
</div>
<p><a href="" id="ref-ce-edf-search-path"></a></p>
<h3 id="the-edf-search-path">The EDF search path<a class="headerlink" href="#the-edf-search-path" title="Permanent link">&para;</a></h3>
<p>By default, the EDFs for each user are looked up in <code>$HOME/.edf</code>.
The search path for EDFs can be controlled through the <code>EDF_PATH</code> environment variable.
<code>EDF_PATH</code> must be a colon-separated list of absolute paths to directories where the CE looks for TOML files, similar to the <code>PATH</code> and L<code>D_LIBRARY_PATH</code> variables.
If a file is located in the search path, its name can be used in <code>--environment</code> options without the <code>.toml</code> extension, for example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>&gt;<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>~/.edf
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>total<span class="w"> </span><span class="m">8</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>&lt;username&gt;<span class="w"> </span>csstaff<span class="w">  </span><span class="m">27</span><span class="w"> </span>Sep<span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">15</span>:19<span class="w"> </span>debian.toml
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>&gt;<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>~/example-project/
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>total<span class="w"> </span><span class="m">4</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>-rw-r-----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>&lt;username&gt;<span class="w"> </span>csstaff<span class="w"> </span><span class="m">28</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">17</span>:44<span class="w"> </span>fedora-env.toml
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>&gt;<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">EDF_PATH</span><span class="o">=</span><span class="nv">$HOME</span>/example-project/
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>--environment<span class="o">=</span>fedora-env<span class="w"> </span>cat<span class="w"> </span>/etc/os-release
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;Fedora Linux&quot;</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="nv">VERSION</span><span class="o">=</span><span class="s2">&quot;40 (Container Image)&quot;</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="nv">ID</span><span class="o">=</span>fedora
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="nv">VERSION_ID</span><span class="o">=</span><span class="m">40</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="nv">VERSION_CODENAME</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="nv">PLATFORM_ID</span><span class="o">=</span><span class="s2">&quot;platform:f40&quot;</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">&quot;Fedora Linux 40 (Container Image)&quot;</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="o">[</span>...<span class="o">]</span>
</span></code></pre></div>
<h2 id="image-management">Image Management<a class="headerlink" href="#image-management" title="Permanent link">&para;</a></h2>
<h3 id="image-cache">Image cache<a class="headerlink" href="#image-cache" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The image caching functionality is only available on the Bristen vCluster as technical preview.</p>
</div>
<p>By default, images defined in the EDF as remote registry references (e.g. a Docker reference) are automatically pulled and locally cached. A cached image would be preferred to pulling the image again in later usage. </p>
<p>An image cache is automatically created at <code>.edf_imagestore</code> in the user's scratch folder (i.e., <code>$SCRATCH/.edf_imagestore</code>), under which cached images are stored in a corresponding CPU architecture subfolder (e.g., <code>x86</code> and <code>aarch64</code>). Users should regularly remove unused cache images to limit the cache size.</p>
<p>Should users want to re-pull a cached image, they have to remove the corresponding image in the cache.</p>
<p>To choose an alternative image store path (e.g., to use a directory owned by a group and not to an individual user), users can specify an image cache path explicitly by defining the environment variable <code>EDF_IMAGESTORE</code>. <code>EDF_IMAGESTORE</code> must be an absolute path to an existing folder.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the CE cannot create a directory for the image cache, it operates in cache-free mode, meaning that it pulls an ephemeral image before every container launch and discards it upon termination.</p>
</div>
<h3 id="pulling-images-manually">Pulling images manually<a class="headerlink" href="#pulling-images-manually" title="Permanent link">&para;</a></h3>
<p>To work with images stored from the NGC Catalog, please refer also to the next section "Using images from third party registries and private repositories".</p>
<p>To bypass any caching behavior, users can manually pull an image and directly plug it into their EDF. To do so, users may execute <code>enroot import docker://[REGISTRY#]IMAGE[:TAG]</code> to pull container images from OCI registries to the current directory.</p>
<p>For example, the command below pulls an <code>nvidia/cuda:11.8.0-cudnn8-devel-ubuntu22.04</code> image.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>$<span class="w"> </span>enroot<span class="w"> </span>import<span class="w"> </span>docker://nvidia/cuda:11.8.0-cudnn8-devel-ubuntu22.04
</span></code></pre></div>
<details class="example">
<summary>Image import w/ full output</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>enroot<span class="w"> </span>import<span class="w"> </span>docker://nvidia/cuda:11.8.0-cudnn8-devel-ubuntu22.04
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Querying<span class="w"> </span>registry<span class="w"> </span><span class="k">for</span><span class="w"> </span>permission<span class="w"> </span>grant
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Authenticating<span class="w"> </span>with<span class="w"> </span>user:<span class="w"> </span>&lt;anonymous&gt;
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Authentication<span class="w"> </span>succeeded
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Fetching<span class="w"> </span>image<span class="w"> </span>manifest<span class="w"> </span>list
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Fetching<span class="w"> </span>image<span class="w"> </span>manifest
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Downloading<span class="w"> </span><span class="m">13</span><span class="w"> </span>missing<span class="w"> </span>layers...
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Extracting<span class="w"> </span>image<span class="w"> </span>layers...
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Converting<span class="w"> </span>whiteouts...
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>squashfs<span class="w"> </span>filesystem...
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>Parallel<span class="w"> </span>mksquashfs:<span class="w"> </span>Using<span class="w"> </span><span class="m">64</span><span class="w"> </span>processors
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>Creating<span class="w"> </span><span class="m">4</span>.0<span class="w"> </span>filesystem<span class="w"> </span>on<span class="w"> </span>/scratch/aistor/&lt;username&gt;/nvidia+cuda+11.8.0-cudnn8-devel-ubuntu22.04.sqsh,<span class="w"> </span>block<span class="w"> </span>size<span class="w"> </span><span class="m">131072</span>.
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>Exportable<span class="w"> </span>Squashfs<span class="w"> </span><span class="m">4</span>.0<span class="w"> </span>filesystem,<span class="w"> </span>zstd<span class="w"> </span>compressed,<span class="w"> </span>data<span class="w"> </span>block<span class="w"> </span>size<span class="w"> </span><span class="m">131072</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">    </span>uncompressed<span class="w"> </span>data,<span class="w"> </span>compressed<span class="w"> </span>metadata,<span class="w"> </span>compressed<span class="w"> </span>fragments,
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">    </span>compressed<span class="w"> </span>xattrs,<span class="w"> </span>compressed<span class="w"> </span>ids
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">    </span>duplicates<span class="w"> </span>are<span class="w"> </span>removed
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>Filesystem<span class="w"> </span>size<span class="w"> </span><span class="m">9492185</span>.87<span class="w"> </span>Kbytes<span class="w"> </span><span class="o">(</span><span class="m">9269</span>.71<span class="w"> </span>Mbytes<span class="o">)</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">    </span><span class="m">98</span>.93%<span class="w"> </span>of<span class="w"> </span>uncompressed<span class="w"> </span>filesystem<span class="w"> </span>size<span class="w"> </span><span class="o">(</span><span class="m">9594893</span>.12<span class="w"> </span>Kbytes<span class="o">)</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>Inode<span class="w"> </span>table<span class="w"> </span>size<span class="w"> </span><span class="m">128688</span><span class="w"> </span>bytes<span class="w"> </span><span class="o">(</span><span class="m">125</span>.67<span class="w"> </span>Kbytes<span class="o">)</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">    </span><span class="m">17</span>.47%<span class="w"> </span>of<span class="w"> </span>uncompressed<span class="w"> </span>inode<span class="w"> </span>table<span class="w"> </span>size<span class="w"> </span><span class="o">(</span><span class="m">736832</span><span class="w"> </span>bytes<span class="o">)</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>Directory<span class="w"> </span>table<span class="w"> </span>size<span class="w"> </span><span class="m">132328</span><span class="w"> </span>bytes<span class="w"> </span><span class="o">(</span><span class="m">129</span>.23<span class="w"> </span>Kbytes<span class="o">)</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">    </span><span class="m">46</span>.42%<span class="w"> </span>of<span class="w"> </span>uncompressed<span class="w"> </span>directory<span class="w"> </span>table<span class="w"> </span>size<span class="w"> </span><span class="o">(</span><span class="m">285091</span><span class="w"> </span>bytes<span class="o">)</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>Number<span class="w"> </span>of<span class="w"> </span>duplicate<span class="w"> </span>files<span class="w"> </span>found<span class="w"> </span><span class="m">1069</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>Number<span class="w"> </span>of<span class="w"> </span>inodes<span class="w"> </span><span class="m">13010</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>Number<span class="w"> </span>of<span class="w"> </span>files<span class="w"> </span><span class="m">10610</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>Number<span class="w"> </span>of<span class="w"> </span>fragments<span class="w"> </span><span class="m">896</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>Number<span class="w"> </span>of<span class="w"> </span>symbolic<span class="w"> </span>links<span class="w">  </span><span class="m">846</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>Number<span class="w"> </span>of<span class="w"> </span>device<span class="w"> </span>nodes<span class="w"> </span><span class="m">0</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>Number<span class="w"> </span>of<span class="w"> </span>fifo<span class="w"> </span>nodes<span class="w"> </span><span class="m">0</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>Number<span class="w"> </span>of<span class="w"> </span>socket<span class="w"> </span>nodes<span class="w"> </span><span class="m">0</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>Number<span class="w"> </span>of<span class="w"> </span>directories<span class="w"> </span><span class="m">1554</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>Number<span class="w"> </span>of<span class="w"> </span>ids<span class="w"> </span><span class="o">(</span>unique<span class="w"> </span>uids<span class="w"> </span>+<span class="w"> </span>gids<span class="o">)</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>Number<span class="w"> </span>of<span class="w"> </span>uids<span class="w"> </span><span class="m">1</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">    </span>root<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>Number<span class="w"> </span>of<span class="w"> </span>gids<span class="w"> </span><span class="m">1</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">    </span>root<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span>
</span></code></pre></div>
</details>
<p>After the import is complete, images are available in Squashfs format in the current directory and can be used in EDFs, for example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>&gt;<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>*.sqsh
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>&lt;username&gt;<span class="w"> </span>csstaff<span class="w"> </span><span class="m">9720037376</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">14</span>:46<span class="w"> </span>nvidia+cuda+11.8.0-cudnn8-devel-ubuntu22.04.sqsh
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>&gt;<span class="w"> </span>realpath<span class="w"> </span>nvidia+cuda+11.8.0-cudnn8-devel-ubuntu22.04.sqsh<span class="w">  </span>/capstor/scratch/cscs/&lt;username&gt;/nvidia+cuda+11.8.0-cudnn8-devel-ubuntu22.04.sqsh
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>&gt;<span class="w"> </span>cat<span class="w"> </span><span class="nv">$HOME</span>/.edf/cudnn8.toml
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/capstor/scratch/cscs/&lt;username&gt;/nvidia+cuda+11.8.0-cudnn8-devel-ubuntu22.04.sqsh&quot;</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended to save images in <code>/capstor/scratch/cscs/&lt;username&gt;</code> or its subdirectories before using them with the CE.</p>
</div>
<p><a href="" id="ref-ce-third-party-private-registries"></a></p>
<h3 id="third-party-and-private-registries">Third-party and private registries<a class="headerlink" href="#third-party-and-private-registries" title="Permanent link">&para;</a></h3>
<p><a href="https://hub.docker.com/">Docker Hub</a> is the default registry from which remote images are imported.</p>
<div class="admonition warning">
<p class="admonition-title">Registry rate limits</p>
<p>Some registries will rate limit image pulls by IP address.
Since <a class="autorefs autorefs-internal" title="Internet Access on Alps" href="../../guides/internet-access/#internet-access-on-alps">public IPs are a shared resource</a> we recommend authenticating even for publicly available images.
For example, <a href="https://docs.docker.com/docker-hub/usage/">Docker Hub applies its rate limits per user when authenticated</a>.</p>
</div>
<p>To use an image from a different registry, the corresponding registry URL has to be prepended to the image reference, using a hash character (#) as a separator. For example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Usage within an EDF</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>&gt;<span class="w"> </span>cat<span class="w"> </span><span class="nv">$HOME</span>/.edf/nvhpc-23.7.toml
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nvcr.io#nvidia/nvhpc:23.7-runtime-cuda11.8-ubuntu22.04&quot;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="c1"># Usage on the command line</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>enroot<span class="w"> </span>import<span class="w"> </span>docker://nvcr.io#nvidia/nvhpc:23.7-runtime-cuda11.8-ubuntu22.04
</span></code></pre></div>
<p>To import images from private repositories, access credentials should be configured by individual users in the <code>$HOME/.config/enroot/.credentials</code> file, following the <a href="https://everything.curl.dev/usingcurl/netrc">netrc file format</a>.
Using the <code>enroot import</code> documentation page as a reference, some examples could be:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># NVIDIA NGC catalog (both endpoints are required)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>machine<span class="w"> </span>nvcr.io<span class="w"> </span>login<span class="w"> </span><span class="nv">$oauthtoken</span><span class="w"> </span>password<span class="w"> </span>&lt;token&gt;
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>machine<span class="w"> </span>authn.nvidia.com<span class="w"> </span>login<span class="w"> </span><span class="nv">$oauthtoken</span><span class="w"> </span>password<span class="w"> </span>&lt;token&gt;
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c1"># DockerHub</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>machine<span class="w"> </span>auth.docker.io<span class="w"> </span>login<span class="w"> </span>&lt;login&gt;<span class="w"> </span>password<span class="w"> </span>&lt;password&gt;
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1"># Google Container Registry with OAuth</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>machine<span class="w"> </span>gcr.io<span class="w"> </span>login<span class="w"> </span>oauth2accesstoken<span class="w"> </span>password<span class="w"> </span><span class="k">$(</span>gcloud<span class="w"> </span>auth<span class="w"> </span>print-access-token<span class="k">)</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="c1"># Google Container Registry with JSON</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>machine<span class="w"> </span>gcr.io<span class="w"> </span>login<span class="w"> </span>_json_key<span class="w"> </span>password<span class="w"> </span><span class="k">$(</span>jq<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="w"> </span><span class="nv">$GOOGLE_APPLICATION_CREDENTIALS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/ /\\u0020/g&#39;</span><span class="k">)</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="c1"># Amazon Elastic Container Registry</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>machine<span class="w"> </span><span class="m">12345</span>.dkr.ecr.eu-west-2.amazonaws.com<span class="w"> </span>login<span class="w"> </span>AWS<span class="w"> </span>password<span class="w"> </span><span class="k">$(</span>aws<span class="w"> </span>ecr<span class="w"> </span>get-login-password<span class="w"> </span>--region<span class="w"> </span>eu-west-2<span class="k">)</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="c1"># Azure Container Registry with ACR refresh token</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>machine<span class="w"> </span>myregistry.azurecr.io<span class="w"> </span>login<span class="w"> </span><span class="m">00000000</span>-0000-0000-0000-000000000000<span class="w"> </span>password<span class="w"> </span><span class="k">$(</span>az<span class="w"> </span>acr<span class="w"> </span>login<span class="w"> </span>--name<span class="w"> </span>myregistry<span class="w"> </span>--expose-token<span class="w"> </span>--query<span class="w"> </span>accessToken<span class="w">  </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;&quot;&#39;</span><span class="k">)</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="c1"># Azure Container Registry with ACR admin user</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>machine<span class="w"> </span>myregistry.azurecr.io<span class="w"> </span>login<span class="w"> </span>myregistry<span class="w"> </span>password<span class="w"> </span><span class="k">$(</span>az<span class="w"> </span>acr<span class="w"> </span>credential<span class="w"> </span>show<span class="w"> </span>--name<span class="w"> </span>myregistry<span class="w"> </span>--subscription<span class="w"> </span>mysub<span class="w"> </span>--query<span class="w"> </span>passwords<span class="o">[</span><span class="m">0</span><span class="o">]</span>.value<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;&quot;&#39;</span><span class="k">)</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="c1"># Github.com Container Registry (GITHUB_TOKEN needs read:packages scope)</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>machine<span class="w"> </span>ghcr.io<span class="w"> </span>login<span class="w"> </span>&lt;username&gt;<span class="w"> </span>password<span class="w"> </span>&lt;GITHUB_TOKEN&gt;
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="c1"># GitLab Container Registry (GITLAB_TOKEN needs a scope with read access to the container registry)</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="c1"># GitLab instances often use different domains for the registry and the authentication service, respectively</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="c1"># Two separate credential entries are required in such cases, for example:</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="c1"># Gitlab.com</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>machine<span class="w"> </span>registry.gitlab.com<span class="w"> </span>login<span class="w"> </span>&lt;username&gt;<span class="w"> </span>password<span class="w"> </span>&lt;GITLAB<span class="w"> </span>TOKEN&gt;
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>machine<span class="w"> </span>gitlab.com<span class="w"> </span>login<span class="w"> </span>&lt;username&gt;<span class="w"> </span>password<span class="w"> </span>&lt;GITLAB<span class="w"> </span>TOKEN&gt;
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="c1"># ETH Zurich GitLab registry</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>machine<span class="w"> </span>registry.ethz.ch<span class="w"> </span>login<span class="w"> </span>&lt;username&gt;<span class="w"> </span>password<span class="w"> </span>&lt;GITLAB_TOKEN&gt;
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>machine<span class="w"> </span>gitlab.ethz.ch<span class="w"> </span>login<span class="w"> </span>&lt;username&gt;<span class="w"> </span>password<span class="w"> </span>&lt;GITLAB_TOKEN&gt;<span class="w">  </span>
</span></code></pre></div>
<a href="" id="ref-ce-annotations"></a></p>
<h2 id="annotations">Annotations<a class="headerlink" href="#annotations" title="Permanent link">&para;</a></h2>
<p>Annotations define arbitrary metadata for containers in the form of key-value pairs. Within the EDF, annotations are designed to be similar in appearance and behavior to those defined by the <a href="https://github.com/opencontainers/runtime-spec/blob/main/config.md#annotations">OCI Runtime Specification</a>. Annotation keys usually express a hierarchical namespace structure, with domains separated by "." (full stop) characters.</p>
<p>As annotations are often used to control hooks, they have a deep nesting level. For example, to execute the <a class="autorefs autorefs-internal" title="SSH Hook" href="#ssh-hook">SSH hook</a> described below, the annotation <code>com.hooks.ssh.enabled</code> must be set to the string <code>true</code>.</p>
<p>EDF files support setting annotations through the <code>annotations</code> table. This can be done in multiple ways in TOML: for example, both of the following usages are equivalent:</p>
<ul>
<li>
<p>Case: nest levels in the TOML key.
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>com.hooks.ssh.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Case: nest levels in the TOML table name.
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="o">[</span>annotations.com.hooks.ssh<span class="o">]</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nv">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div></p>
</li>
</ul>
<p>To avoid mistakes, notice a few key features of TOML:</p>
<ul>
<li>All property assignments belong to the section immediately preceding them (the statement in square brackets), which defines the table they refer to.</li>
<li>Tables, on the other hand, do not automatically belong to the tables declared before them; to nest tables, their name has to list their parents using the dot notations (so the previous example defines the table <code>ssh</code> inside <code>hooks</code>, which in turn is inside <code>com</code>, which is inside <code>annotations</code>).</li>
<li>An assignment can implicitly define subtables if the key you assign is a dotted list. As a reference, see the examples made earlier in this section, where assigning a string to the <code>com.hooks.ssh.enabled</code> attribute within the <code>[annotations]</code> table is exactly equivalent to assigning to the <code>enabled</code> attribute within the <code>[annotations.com.hooks.ssh]</code> subtable.</li>
<li>
<p>Attributes can be added to a table only in one place in the TOML file. In other words, each table must be defined in a single square bracket section. For example, Case 3 in the example below is invalid because the <code>ssh</code> table was doubly defined both in the <code>[annotations]</code> and in the <code>[annotations.com.hooks.ssh]</code> sections. See the <a href="https://toml.io/en/">TOML format</a> spec for more details.</p>
<ul>
<li>
<p>Case 1 (valid):
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="o">[</span>annotations.com.hooks.ssh<span class="o">]</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nv">authorize_ssh_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/capstor/scratch/cscs/&lt;username&gt;/tests/edf/authorized_keys&quot;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nv">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Case 2 (valid):
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>com.hooks.ssh.authorize_ssh_key<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/capstor/scratch/cscs/&lt;username&gt;/tests/edf/authorized_keys&quot;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>com.hooks.ssh.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Case 3 (<strong>invalid</strong>):
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>com.hooks.ssh.authorize_ssh_key<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/capstor/scratch/cscs/&lt;username&gt;/tests/edf/authorized_keys&quot;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="o">[</span>annotations.com.hooks.ssh<span class="o">]</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nv">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div></p>
</li>
</ul>
</li>
</ul>
<h2 id="accessing-native-resources">Accessing native resources<a class="headerlink" href="#accessing-native-resources" title="Permanent link">&para;</a></h2>
<h3 id="nvidia-gpus">NVIDIA GPUs<a class="headerlink" href="#nvidia-gpus" title="Permanent link">&para;</a></h3>
<p>The Container Engine leverages components from the NVIDIA Container Toolkit to expose NVIDIA GPU devices inside containers.
GPU device files are always mounted in containers, and the NVIDIA driver user space components are  mounted if the <code>NVIDIA_VISIBLE_DEVICES</code> environment variable is not empty, unset or set to <code>void</code>.  <code>NVIDIA_VISIBLE_DEVICES</code> is already set in container images officially provided by NVIDIA to enable all GPUs available on the host system. Such images are frequently used to containerize CUDA applications, either directly or as a base for custom images, thus in many cases no action is required to access GPUs.
For example, on a cluster with 4 GH200 devices per compute node:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>&gt;<span class="w"> </span>cat<span class="w"> </span>.edf/cuda12.5.1.toml<span class="w"> </span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nvidia/cuda:12.5.1-devel-ubuntu24.04&quot;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>--environment<span class="o">=</span>cuda12.5.1<span class="w"> </span>nvidia-smi
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>Thu<span class="w"> </span>Oct<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">17</span>:59:36<span class="w"> </span><span class="m">2023</span><span class="w">       </span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>+------------------------------------------------------------------------------------+
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="p">|</span><span class="w"> </span>NVIDIA-SMI<span class="w"> </span><span class="m">535</span>.129.03<span class="w">          </span>Driver<span class="w"> </span>Version:<span class="w"> </span><span class="m">535</span>.129.03<span class="w">   </span>CUDA<span class="w"> </span>Version:<span class="w"> </span><span class="m">12</span>.5<span class="w">     </span><span class="p">|</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="p">|</span>--------------------------------------+----------------------+----------------------+
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="p">|</span><span class="w"> </span>GPU<span class="w">  </span>Name<span class="w">              </span>Persistence-M<span class="w"> </span><span class="p">|</span><span class="w"> </span>Bus-Id<span class="w">        </span>Disp.A<span class="w"> </span><span class="p">|</span><span class="w"> </span>Volatile<span class="w"> </span>Uncorr.<span class="w"> </span>ECC<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="p">|</span><span class="w"> </span>Fan<span class="w">  </span>Temp<span class="w">   </span>Perf<span class="w">       </span>Pwr:Usage/Cap<span class="w"> </span><span class="p">|</span><span class="w">         </span>Memory-Usage<span class="w"> </span><span class="p">|</span><span class="w"> </span>GPU-Util<span class="w">  </span>Compute<span class="w"> </span>M.<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="p">|</span><span class="w">                                      </span><span class="p">|</span><span class="w">                      </span><span class="p">|</span><span class="w">               </span>MIG<span class="w"> </span>M.<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="p">|</span><span class="o">======================================</span>+<span class="o">======================</span>+<span class="o">======================</span><span class="p">|</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="p">|</span><span class="w">   </span><span class="m">0</span><span class="w">  </span>GH200<span class="w"> </span>120GB<span class="w">                 </span>On<span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="m">00000009</span>:01:00.0<span class="w"> </span>Off<span class="w"> </span><span class="p">|</span><span class="w">                    </span><span class="m">0</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="p">|</span><span class="w"> </span>N/A<span class="w">   </span>24C<span class="w">    </span>P0<span class="w">           </span>89W<span class="w"> </span>/<span class="w"> </span>900W<span class="w"> </span><span class="p">|</span><span class="w">     </span>37MiB<span class="w"> </span>/<span class="w"> </span>97871MiB<span class="w"> </span><span class="p">|</span><span class="w">      </span><span class="m">0</span>%<span class="w">   </span>E.<span class="w"> </span>Process<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="p">|</span><span class="w">                                      </span><span class="p">|</span><span class="w">                      </span><span class="p">|</span><span class="w">             </span>Disabled<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>+--------------------------------------+----------------------+----------------------+
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="p">|</span><span class="w">   </span><span class="m">1</span><span class="w">  </span>GH200<span class="w"> </span>120GB<span class="w">                 </span>On<span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="m">00000019</span>:01:00.0<span class="w"> </span>Off<span class="w"> </span><span class="p">|</span><span class="w">                    </span><span class="m">0</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="p">|</span><span class="w"> </span>N/A<span class="w">   </span>24C<span class="w">    </span>P0<span class="w">           </span>87W<span class="w"> </span>/<span class="w"> </span>900W<span class="w"> </span><span class="p">|</span><span class="w">     </span>37MiB<span class="w"> </span>/<span class="w"> </span>97871MiB<span class="w"> </span><span class="p">|</span><span class="w">      </span><span class="m">0</span>%<span class="w">   </span>E.<span class="w"> </span>Process<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="p">|</span><span class="w">                                      </span><span class="p">|</span><span class="w">                      </span><span class="p">|</span><span class="w">             </span>Disabled<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>+--------------------------------------+----------------------+----------------------+
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="p">|</span><span class="w">   </span><span class="m">2</span><span class="w">  </span>GH200<span class="w"> </span>120GB<span class="w">                 </span>On<span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="m">00000029</span>:01:00.0<span class="w"> </span>Off<span class="w"> </span><span class="p">|</span><span class="w">                    </span><span class="m">0</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="p">|</span><span class="w"> </span>N/A<span class="w">   </span>24C<span class="w">    </span>P0<span class="w">           </span>83W<span class="w"> </span>/<span class="w"> </span>900W<span class="w"> </span><span class="p">|</span><span class="w">     </span>37MiB<span class="w"> </span>/<span class="w"> </span>97871MiB<span class="w"> </span><span class="p">|</span><span class="w">      </span><span class="m">0</span>%<span class="w">   </span>E.<span class="w"> </span>Process<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="p">|</span><span class="w">                                      </span><span class="p">|</span><span class="w">                      </span><span class="p">|</span><span class="w">             </span>Disabled<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>+--------------------------------------+----------------------+----------------------+
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="p">|</span><span class="w">   </span><span class="m">3</span><span class="w">  </span>GH200<span class="w"> </span>120GB<span class="w">                 </span>On<span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="m">00000039</span>:01:00.0<span class="w"> </span>Off<span class="w"> </span><span class="p">|</span><span class="w">                    </span><span class="m">0</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="p">|</span><span class="w"> </span>N/A<span class="w">   </span>24C<span class="w">    </span>P0<span class="w">           </span>85W<span class="w"> </span>/<span class="w"> </span>900W<span class="w"> </span><span class="p">|</span><span class="w">     </span>37MiB<span class="w"> </span>/<span class="w"> </span>97871MiB<span class="w"> </span><span class="p">|</span><span class="w">      </span><span class="m">0</span>%<span class="w">   </span>E.<span class="w"> </span>Process<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="p">|</span><span class="w">                                      </span><span class="p">|</span><span class="w">                      </span><span class="p">|</span><span class="w">             </span>Disabled<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>+--------------------------------------+----------------------+----------------------+
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>+------------------------------------------------------------------------------------+
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="p">|</span><span class="w"> </span>Processes:<span class="w">                                                                         </span><span class="p">|</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="p">|</span><span class="w">  </span>GPU<span class="w">   </span>GI<span class="w">   </span>CI<span class="w">        </span>PID<span class="w">   </span>Type<span class="w">   </span>Process<span class="w"> </span>name<span class="w">                         </span>GPU<span class="w"> </span>Memory<span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="p">|</span><span class="w">        </span>ID<span class="w">   </span>ID<span class="w">                                                          </span>Usage<span class="w">      </span><span class="p">|</span>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="p">|</span><span class="o">====================================================================================</span><span class="p">|</span>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="p">|</span><span class="w">  </span>No<span class="w"> </span>running<span class="w"> </span>processes<span class="w"> </span>found<span class="w">                                                        </span><span class="p">|</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>+------------------------------------------------------------------------------------+
</span></code></pre></div>
<p>It is possible to use environment variables to control which capabilities of the NVIDIA driver are enabled inside containers.
Additionally, the NVIDIA Container Toolkit can enforce specific constraints for the container, for example, on versions of the CUDA runtime or driver, or on the architecture of the GPUs.
For the full details about using these features, please refer to the official documentation: <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/docker-specialized.html#driver-capabilities">Driver Capabilities</a>, <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/docker-specialized.html#constraints">Constraints</a>.</p>
<p><a href="" id="ref-ce-cxi-hook"></a></p>
<h3 id="hpe-slingshot-interconnect">HPE Slingshot interconnect<a class="headerlink" href="#hpe-slingshot-interconnect" title="Permanent link">&para;</a></h3>
<p>The Container Engine provides a hook to allow containers relying on <a href="https://ofiwg.github.io/libfabric/">libfabric</a> to leverage the HPE Slingshot 11 high-speed interconnect. This component is commonly referred to as the "CXI hook", taking its name from the CXI libfabric provider required to interface with Slingshot 11.
The hook leverages bind-mounting the custom host libfabric library into the container (in addition to all the required dependency libraries and devices as well).
If a libfabric library is already present in the container filesystem (for example, it's provided by the image), it is replaced with its host counterpart, otherwise the host libfabric is just added to the container.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to the nature of Slingshot and the mechanism implemented by the CXI hook, container applications need to use a communication library which supports libfabric in order to benefit from usage of the hook.</p>
</div>
<blockquote>
<p>Libfabric support might have to be defined at compilation time (as is the case for some MPI implementations, like MPICH and OpenMPI) or could be dynamically available at runtime (as is the case with NCCL - see also <a class="autorefs autorefs-internal" title="AWS OFI NCCL Hook" href="#aws-ofi-nccl-hook">this</a> section for more details).</p>
</blockquote>
<p>The hook is activated by setting the <code>com.hooks.cxi.enabled</code> annotation, which can be defined in the EDF, as shown in the following example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Without the CXI hook</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>&gt;<span class="w"> </span>cat<span class="w"> </span><span class="nv">$HOME</span>/.edf/osu-mb.toml<span class="w"> </span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;quay.io#madeeks/osu-mb:6.2-mpich4.1-ubuntu22.04-arm64&quot;</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>com.hooks.cxi.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;false&quot;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>-N2<span class="w"> </span>--mpi<span class="o">=</span>pmi2<span class="w"> </span>--environment<span class="o">=</span>osu-mb<span class="w"> </span>./osu_bw
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="c1"># OSU MPI Bandwidth Test v6.2</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="c1"># Size      Bandwidth (MB/s)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="m">1</span><span class="w">                       </span><span class="m">0</span>.22
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="m">2</span><span class="w">                       </span><span class="m">0</span>.40
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="m">4</span><span class="w">                       </span><span class="m">0</span>.90
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="m">8</span><span class="w">                       </span><span class="m">1</span>.82
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="m">16</span><span class="w">                      </span><span class="m">3</span>.41
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="m">32</span><span class="w">                      </span><span class="m">6</span>.81
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="m">64</span><span class="w">                     </span><span class="m">13</span>.18
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="m">128</span><span class="w">                    </span><span class="m">26</span>.74
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="m">256</span><span class="w">                    </span><span class="m">11</span>.95
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="m">512</span><span class="w">                    </span><span class="m">38</span>.06
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="m">1024</span><span class="w">                   </span><span class="m">39</span>.65
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="m">2048</span><span class="w">                   </span><span class="m">83</span>.22
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="m">4096</span><span class="w">                  </span><span class="m">156</span>.14
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="m">8192</span><span class="w">                  </span><span class="m">143</span>.08
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="m">16384</span><span class="w">                  </span><span class="m">53</span>.78
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="m">32768</span><span class="w">                 </span><span class="m">106</span>.77
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="m">65536</span><span class="w">                  </span><span class="m">49</span>.88
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="m">131072</span><span class="w">                </span><span class="m">871</span>.86
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="m">262144</span><span class="w">                </span><span class="m">780</span>.97
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="m">524288</span><span class="w">                </span><span class="m">694</span>.58
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="m">1048576</span><span class="w">               </span><span class="m">831</span>.02
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="m">2097152</span><span class="w">              </span><span class="m">1363</span>.30
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="m">4194304</span><span class="w">              </span><span class="m">1279</span>.54
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="c1"># With the CXI hook enabling access to the Slingshot high-speed network</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>&gt;<span class="w"> </span>cat<span class="w"> </span>.edf/osu-mb-cxi.toml<span class="w"> </span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;quay.io#madeeks/osu-mb:6.2-mpich4.1-ubuntu22.04&quot;</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>com.hooks.cxi.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>-N2<span class="w"> </span>--mpi<span class="o">=</span>pmi2<span class="w"> </span>--environment<span class="o">=</span>osu-mb-cxi<span class="w"> </span>./osu_bw
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="c1"># OSU MPI Bandwidth Test v6.2</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="c1"># Size      Bandwidth (MB/s)</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="m">1</span><span class="w">                       </span><span class="m">1</span>.21
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="m">2</span><span class="w">                       </span><span class="m">2</span>.32
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="m">4</span><span class="w">                       </span><span class="m">4</span>.85
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="m">8</span><span class="w">                       </span><span class="m">8</span>.38
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a><span class="m">16</span><span class="w">                     </span><span class="m">19</span>.36
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="m">32</span><span class="w">                     </span><span class="m">38</span>.47
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="m">64</span><span class="w">                     </span><span class="m">76</span>.28
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="m">128</span><span class="w">                   </span><span class="m">151</span>.76
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a><span class="m">256</span><span class="w">                   </span><span class="m">301</span>.25
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a><span class="m">512</span><span class="w">                   </span><span class="m">604</span>.17
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a><span class="m">1024</span><span class="w">                 </span><span class="m">1145</span>.03
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a><span class="m">2048</span><span class="w">                 </span><span class="m">2367</span>.25
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a><span class="m">4096</span><span class="w">                 </span><span class="m">4817</span>.16
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a><span class="m">8192</span><span class="w">                 </span><span class="m">8633</span>.36
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a><span class="m">16384</span><span class="w">               </span><span class="m">16971</span>.18
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a><span class="m">32768</span><span class="w">               </span><span class="m">18740</span>.55
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a><span class="m">65536</span><span class="w">               </span><span class="m">21978</span>.65
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a><span class="m">131072</span><span class="w">              </span><span class="m">22962</span>.31
</span><span id="__span-18-64"><a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a><span class="m">262144</span><span class="w">              </span><span class="m">23436</span>.78
</span><span id="__span-18-65"><a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a><span class="m">524288</span><span class="w">              </span><span class="m">23672</span>.92
</span><span id="__span-18-66"><a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a><span class="m">1048576</span><span class="w">             </span><span class="m">23827</span>.78
</span><span id="__span-18-67"><a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a><span class="m">2097152</span><span class="w">             </span><span class="m">23890</span>.95
</span><span id="__span-18-68"><a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a><span class="m">4194304</span><span class="w">             </span><span class="m">23925</span>.61
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>On several vClusters, the CXI hook for Slingshot connectivity is enabled implicitly by default or by other hooks.
Therefore, entering the enabling annotation in the EDF is unnecessary in many cases.</p>
</div>
<p><a href="" id="ref-ce-container-hooks"></a></p>
<h2 id="container-hooks">Container Hooks<a class="headerlink" href="#container-hooks" title="Permanent link">&para;</a></h2>
<p>Container hooks let you customize container behavior to fit system-specific needs, making them especially valuable for High-Performance Computing.</p>
<ul>
<li><em>What they do</em>: Hooks extend container runtime functionality by enabling custom actions during a container's lifecycle.</li>
<li><em>Use for HPC</em>: HPC systems rely on specialized hardware and fine-tuned software, unlike generic containers. Hooks bridge this gap by allowing containers to access these system-specific resources or enable custom features.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This section outlines all hooks supported in production by the Container Engine.
However, specific Alps vClusters may support only a subset or use custom configurations.
For details about available features in individual vClusters, consult platform documentation or contact CSCS support.</p>
</div>
<p><a href="" id="ref-ce-aws-ofi-hook"></a></p>
<h3 id="aws-ofi-nccl-hook">AWS OFI NCCL Hook<a class="headerlink" href="#aws-ofi-nccl-hook" title="Permanent link">&para;</a></h3>
<p>The <a href="https://github.com/aws/aws-ofi-nccl">AWS OFI NCCL plugin</a> is a software extension that allows the <a href="https://developer.nvidia.com/nccl">NCCL</a> and <a href="https://rocm.docs.amd.com/projects/rccl/en/latest/">RCCL</a> libraries to use libfabric as a network provider and, through libfabric, to access the Slingshot high-speed interconnect.</p>
<p>The Container Engine includes a hook program to inject the AWS OFI NCCL plugin in containers; since the plugin must also be compatible with the GPU programming software stack being used, the <code>com.hooks.aws_ofi_nccl.variant</code> annotation is used to specify a plugin variant suitable for a given container image.
At the moment of writing, 4 plugin variants are configured: <code>cuda11</code>, <code>cuda12</code> (to be used on NVIDIA GPU nodes), <code>rocm5</code>, and <code>rocm6</code> (to be used on AMD GPU nodes alongside RCCL).
For example, the following EDF enables the hook and uses it to mount the plugin in a CUDA 11 image:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nvcr.io#nvidia/pytorch:22.12-py3&quot;</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nv">mounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;/capstor/scratch/cscs/amadonna:/capstor/scratch/cscs/amadonna&quot;</span><span class="o">]</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="nv">entrypoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>com.hooks.aws_ofi_nccl.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>com.hooks.aws_ofi_nccl.variant<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cuda11&quot;</span>
</span></code></pre></div>
<p>The AWS OFI NCCL hook also takes care of the following aspects:</p>
<ul>
<li>It implicitly enables the <a class="autorefs autorefs-internal" title="HPE Slingshot interconnect" href="#hpe-slingshot-interconnect">CXI hook</a>, therefore exposing the Slingshot interconnect to container applications. In other words, when enabling the AWS OFI NCCL hook, it's unnecessary to also enable the CXI hook separately in the EDF.</li>
<li>It sets environment variables to control the behavior of NCCL and the libfabric CXI provider for Slingshot. In particular, the <code>NCCL_NET_PLUGIN</code> variable (<a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-net-plugin">link</a>) is set to force NCCL to load the specific network plugin mounted by the hook. This is useful because certain container images (for example, those from NGC repositories) might already ship with a default NCCL plugin. Other environment variables help prevent application stalls and improve performance when using GPUDirect for RDMA communication.</li>
</ul>
<p><a href="" id="ref-ce-ssh-hook"></a></p>
<h3 id="ssh-hook">SSH Hook<a class="headerlink" href="#ssh-hook" title="Permanent link">&para;</a></h3>
<p>The SSH hook runs a lightweight, statically-linked SSH server (a build of <a href="https://matt.ucc.asn.au/dropbear/dropbear.html">Dropbear</a>) inside the container. It can be useful to add SSH connectivity to containers (for example, enabling remote debugging) without bundling an SSH server into the container image or creating ad-hoc image variants for such purposes.</p>
<p>The <code>com.hooks.ssh.authorize_ssh_key</code> annotation allows the authorization of a custom public SSH key for remote connections. The annotation value must be the absolute path to a text file containing the public key (just the public key without any extra signature/certificate). After the container starts, it is possible to get a remote shell inside the container by connecting with SSH to the listening port.</p>
<p>By default, the server started by the SSH hook listens to port 15263, but this setting can be controlled through the <code>com.hooks.ssh.port</code> annotation in the EDF.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use the SSH hook, it is <strong>required</strong> to keep the container <strong>writable</strong>.</p>
</div>
<p>The following EDF file shows an example of enabling the SSH hook and authorizing a user-provided public key:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>&gt;<span class="w"> </span>cat<span class="w"> </span><span class="nv">$HOME</span>/.edf/ubuntu-ssh.toml
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ubuntu:latest&quot;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="nv">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="o">[</span>annotations.com.hooks.ssh<span class="o">]</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="nv">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="nv">authorize_ssh_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&lt;public key file&gt;&quot;</span>
</span></code></pre></div>
<p>Using the previous EDF, a container can be started as follows. Notice that the <code>--pty</code> option for the <code>srun</code> command is currently required in order for the hook to initialize properly:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>--environment<span class="o">=</span>ubuntu-ssh<span class="w"> </span>--pty<span class="w"> </span>&lt;command&gt;
</span></code></pre></div>
<p>While the container is running, it's possible to connect to it from a remote host using a private key matching the public one authorized in the EDF annotation. For example, in a host where such private key is the default identity file, the following command could be used:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>ssh<span class="w"> </span>-p<span class="w"> </span><span class="m">15263</span><span class="w"> </span>&lt;host-of-container&gt;
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>In order to establish connections through Visual Studio Code <a href="https://code.visualstudio.com/docs/remote/ssh">Remote - SSH</a> extension, the <code>scp</code> program must be available within the container.
This is required to send and establish the VS Code Server into the remote container.</p>
</div>
<h3 id="nvidia-cuda-mps-hook">NVIDIA CUDA MPS Hook<a class="headerlink" href="#nvidia-cuda-mps-hook" title="Permanent link">&para;</a></h3>
<p>On several Alps vClusters, NVIDIA GPUs by default operate in "Exclusive process" mode, that is, the CUDA driver is configured to allow only one process at a time to use a given GPU.
For example, on a node with 4 GPUs, a maximum of 4 CUDA processes can run at the same time:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>&gt;<span class="w"> </span>nvidia-smi<span class="w"> </span>-L
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>GPU<span class="w"> </span><span class="m">0</span>:<span class="w"> </span>GH200<span class="w"> </span>120GB<span class="w"> </span><span class="o">(</span>UUID:<span class="w"> </span>GPU-...<span class="o">)</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>GPU<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>GH200<span class="w"> </span>120GB<span class="w"> </span><span class="o">(</span>UUID:<span class="w"> </span>GPU-...<span class="o">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>GPU<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>GH200<span class="w"> </span>120GB<span class="w"> </span><span class="o">(</span>UUID:<span class="w"> </span>GPU-...<span class="o">)</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>GPU<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>GH200<span class="w"> </span>120GB<span class="w"> </span><span class="o">(</span>UUID:<span class="w"> </span>GPU-...<span class="o">)</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="c1"># This EDF uses the CUDA vector addition sample from NVIDIA&#39;s NGC catalog</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>&gt;<span class="w"> </span>cat<span class="w"> </span><span class="nv">$HOME</span>/.edf/vectoradd-cuda.toml
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nvcr.io#nvidia/k8s/cuda-sample:vectoradd-cuda12.5.0-ubuntu22.04&quot;</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="c1"># 4 processes run successfully</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>-t2<span class="w"> </span>-N1<span class="w"> </span>-n4<span class="w"> </span>--environment<span class="o">=</span>vectoradd-cuda<span class="w"> </span>/cuda-samples/vectorAdd<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Test PASSED&quot;</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>Test<span class="w"> </span>PASSED
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>Test<span class="w"> </span>PASSED
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>Test<span class="w"> </span>PASSED
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>Test<span class="w"> </span>PASSED
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="c1"># More than 4 concurrent processes result in oversubscription errors</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>-t2<span class="w"> </span>-N1<span class="w"> </span>-n5<span class="w"> </span>--environment<span class="o">=</span>vectoradd-cuda<span class="w"> </span>/cuda-samples/vectorAdd<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Test PASSED&quot;</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>Failed<span class="w"> </span>to<span class="w"> </span>allocate<span class="w"> </span>device<span class="w"> </span>vector<span class="w"> </span>A<span class="w"> </span><span class="o">(</span>error<span class="w"> </span>code<span class="w"> </span>CUDA-capable<span class="w"> </span>device<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>is/are<span class="w"> </span>busy<span class="w"> </span>or<span class="w"> </span>unavailable<span class="o">)</span>!
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>srun:<span class="w"> </span>error:<span class="w"> </span><span class="o">[</span>...<span class="o">]</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="o">[</span>...<span class="o">]</span>
</span></code></pre></div>
<p>In order to run multiple processes concurrently on the same GPU (one example could be running multiple MPI ranks on the same device), the <a href="https://docs.nvidia.com/deploy/mps/index.html">NVIDIA CUDA Multi-Process Service</a> (or MPS, for short) must be started on the compute node.</p>
<p>The Container Engine provides a hook to automatically manage the setup and removal of the NVIDIA CUDA MPS components within containers.
The hook can be activated by setting the <code>com.hooks.nvidia_cuda_mps.enabled</code> to the string <code>true</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use the CUDA MPS hook, it is <strong>required</strong> to keep the container <strong>writable</strong>.</p>
</div>
<p>The following is an example of using the NVIDIA CUDA MPS hook:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>&gt;<span class="w"> </span>cat<span class="w"> </span><span class="nv">$HOME</span>/.edf/vectoradd-cuda-mps.toml
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nvcr.io#nvidia/k8s/cuda-sample:vectoradd-cuda12.5.0-ubuntu22.04&quot;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="nv">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>com.hooks.nvidia_cuda_mps.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>-t2<span class="w"> </span>-N1<span class="w"> </span>-n8<span class="w"> </span>--environment<span class="o">=</span>vectoradd-cuda-mps<span class="w"> </span>/cuda-samples/vectorAdd<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Test PASSED&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="m">8</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>When using the NVIDIA CUDA MPS hook it is not necessary to use other wrappers or scripts to manage the Multi-Process Service, as is documented for native jobs on some vClusters.</p>
</div>
<p><a href="" id="ref-ce-edf-reference"></a></p>
<h2 id="edf-reference">EDF Reference<a class="headerlink" href="#edf-reference" title="Permanent link">&para;</a></h2>
<p>EDF files use the <a href="https://toml.io/en/">TOML format</a>. For details about the data types used by the different parameters, please refer to the <a href="https://toml.io/en/v1.0.0">TOML spec webpage</a>.</p>
<p>In the following, the default value is none (i.e., the empty value of the corresponding type) if not specified.</p>
<h3 id="array-or-string-base_environment">(ARRAY or STRING) base_environment<a class="headerlink" href="#array-or-string-base_environment" title="Permanent link">&para;</a></h3>
<p>Ordered list of EDFs that this file inherits from. Parameters from listed environments are evaluated sequentially. Supports up to 10 levels of recursion.</p>
<details class="note">
<summary>Note</summary>
<ul>
<li>Parameters from the listed environments are evaluated sequentially, adding new entries or overwriting previous ones, before evaluating the parameters from the current EDF. In other words, the current EDF inherits the parameters from the EDFs listed in <code>base_environment</code>. When evaluating <code>mounts</code> or <code>env</code> parameters, values from downstream EDFs are appended to inherited values.</li>
<li>The individual EDF entries in the array follow the same search rules as the arguments of the <code>--environment</code> CLI option for Slurm; they can be either file paths or filenames without extension if the file is located in the <a class="autorefs autorefs-internal" title="The EDF search path" href="#the-edf-search-path">EDF search path</a>.</li>
<li>This parameter can be a string if there is only one base environment.</li>
</ul>
</details>
<details class="example">
<summary>Example</summary>
<ul>
<li>
<p>Single environment inheritance:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nv">base_environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;common_env&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Multiple environment inheritance:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nv">base_environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;common_env&quot;</span>,<span class="w"> </span><span class="s2">&quot;ml_pytorch_env1&quot;</span><span class="o">]</span>
</span></code></pre></div></p>
</li>
</ul>
</details>
<h3 id="string-image">(STRING) image<a class="headerlink" href="#string-image" title="Permanent link">&para;</a></h3>
<p>The container image to use. Can reference a remote Docker/OCI registry or a local Squashfs file as a filesystem path.</p>
<details class="note">
<summary>Note</summary>
<ul>
<li>The full format for remote references is <code>[USER@][REGISTRY#]IMAGE[:TAG]</code>.<ul>
<li><code>[REGISTRY#]</code>: (optional) registry URL, followed by #. Default: Docker Hub.</li>
<li><code>IMAGE</code>: image name.</li>
<li><code>[:TAG]</code>: (optional) image tag name, preceded by :.</li>
</ul>
</li>
<li>The registry user can also be specified in the <code>$HOME/.config/enroot/.credentials</code> file.</li>
</ul>
</details>
<details class="example">
<summary>Example</summary>
<ul>
<li>
<p>Reference of Ubuntu image in the Docker Hub registry (default registry)
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;library/ubuntu:24.04&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Explicit reference of Ubuntu image in the Docker Hub registry
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;docker.io#library/ubuntu:24.04&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Reference to PyTorch image from NVIDIA Container Registry (nvcr.io)
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nvcr.io#nvidia/pytorch:22.12-py3&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Image from third-party quay.io registry
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;quay.io#madeeks/osu-mb:6.2-mpich4.1-ubuntu22.04-arm64&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Reference to a manually pulled image stored in parallel FS
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/path/to/image.squashfs&quot;</span>
</span></code></pre></div></p>
</li>
</ul>
</details>
<h3 id="string-workdir">(STRING) workdir<a class="headerlink" href="#string-workdir" title="Permanent link">&para;</a></h3>
<p>Initial working directory when the container starts. Default: inherited from image.</p>
<details class="example">
<summary>Example</summary>
<ul>
<li>Workdir pointing to a user defined project path 
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nv">workdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/home/user/projects&quot;</span>
</span></code></pre></div></li>
<li>Workdir pointing to the <code>/tmp</code> directory
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nv">workdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/tmp&quot;</span>
</span></code></pre></div></li>
</ul>
</details>
<h3 id="bool-entrypoint">(BOOL) entrypoint<a class="headerlink" href="#bool-entrypoint" title="Permanent link">&para;</a></h3>
<p>If true, run the entrypoint from the container image. Default: true.</p>
<details class="example">
<summary>Example</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nv">entrypoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
</span></code></pre></div>
</details>
<h3 id="bool-writable">(BOOL) writable<a class="headerlink" href="#bool-writable" title="Permanent link">&para;</a></h3>
<p>If false, the container filesystem is read-only. Default: false.</p>
<details class="example">
<summary>Example</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nv">writable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span></code></pre></div>
</details>
<h3 id="array-mounts">(ARRAY) mounts<a class="headerlink" href="#array-mounts" title="Permanent link">&para;</a></h3>
<p>List of bind mounts in the format <code>SOURCE:DESTINATION[:FLAGS]</code>. Flags are optional and can include <code>ro</code>, <code>private</code>, etc.</p>
<details class="note">
<summary>Note</summary>
<ul>
<li>Mount flags are separated with a plus symbol, for example: <code>ro+private</code>.</li>
<li>Optional flags from docker format or OCI (need reference)</li>
</ul>
</details>
<details class="example">
<summary>Example</summary>
<ul>
<li>
<p>Literal fixed mount map
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nv">mounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;/capstor/scratch/cscs/amadonna:/capstor/scratch/cscs/amadonna&quot;</span><span class="o">]</span>
</span></code></pre></div></p>
</li>
<li>
<p>Mapping path with <code>env</code> variable expansion
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nv">mounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;/capstor/scratch/cscs/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">:/capstor/scratch/cscs/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">]</span>
</span></code></pre></div></p>
</li>
<li>
<p>Mounting the scratch filesystem using a host environment variable
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nv">mounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SCRATCH</span><span class="si">}</span><span class="s2">:/scratch&quot;</span><span class="o">]</span>
</span></code></pre></div></p>
</li>
</ul>
</details>
<h3 id="table-env">(TABLE) env<a class="headerlink" href="#table-env" title="Permanent link">&para;</a></h3>
<p>Environment variables to set in the container. Null-string values will unset the variable. Default: inherited from the host and the image.</p>
<details class="note">
<summary>Note</summary>
<ul>
<li>By default, containers inherit environment variables from the container image and the host environment, with variables from the image taking precedence.</li>
<li>The env table can be used to further customize the container environment by setting, modifying, or unsetting variables.</li>
<li>Values of the table entries must be strings. If an entry has a null value, the variable corresponding to the entry key is unset in the container.</li>
</ul>
</details>
<details class="example">
<summary>Example</summary>
<ul>
<li>
<p>Basic <code>env</code> block
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="o">[</span>env<span class="o">]</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="nv">MY_RUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;production&quot;</span>,
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="nv">DEBUG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;false&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Use of environment variable expansion
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="o">[</span>env<span class="o">]</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="nv">MY_NODE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VAR_FROM_HOST</span><span class="si">}</span><span class="s2">&quot;</span>,
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="nv">PATH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">:/custom/bin&quot;</span>,<span class="w"> </span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="nv">DEBUG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div></p>
</li>
</ul>
</details>
<h3 id="table-annotations">(TABLE) annotations<a class="headerlink" href="#table-annotations" title="Permanent link">&para;</a></h3>
<p>OCI-like annotations for the container. For more details, refer to the <a class="autorefs autorefs-internal" href="#annotations">Annotations</a> section.</p>
<details class="example">
<summary>Example</summary>
<ul>
<li>
<p>Disabling the CXI hook
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>com.hooks.cxi.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;false&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Control of SSH hook parameters via annotation and variable expansion
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="o">[</span>annotations.com.hooks.ssh<span class="o">]</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="nv">authorize_ssh_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/capstor/scratch/cscs/</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">/tests/edf/authorized_keys&quot;</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="nv">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p>Alternative example for usage of annotation with fixed path
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>com.hooks.ssh.authorize_ssh_key<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/path/to/authorized_keys&quot;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>com.hooks.ssh.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span></code></pre></div></p>
</li>
</ul>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Environment variable expansion and relative paths expansion are only available on the Bristen vCluster as technical preview.</p>
</div>
<h3 id="environment-variable-expansion">Environment Variable Expansion<a class="headerlink" href="#environment-variable-expansion" title="Permanent link">&para;</a></h3>
<p>Environment variable expansion allows for dynamic substitution of environment variable values within the EDF (Environment Definition File). This capability applies across all configuration parameters in the EDF, providing flexibility in defining container environments.</p>
<ul>
<li><em>Syntax</em>. Use ${VAR} to reference an environment variable VAR. The variable's value is resolved from the combined environment, which includes variables defined in the host and the container image, the later taking precedence.</li>
<li><em>Scope</em>. Variable expansion is supported across all EDF parameters. This includes EDF’s parameters like mounts, workdir, image, etc. For example, ${SCRATCH} can be used in mounts to reference a directory path.</li>
<li><em>Undefined Variables</em>. Referencing an undefined variable results in an error. To safely handle undefined variables, you can use the syntax ${VAR:-}, which evaluates to an empty string if VAR is undefined.</li>
<li><em>Preventing Expansion</em>. To prevent expansion, use double dollar signs $$. For example, $$${VAR} will render as the literal string ${VAR}.</li>
<li><em>Limitations</em><ul>
<li>Variables defined within the [env] EDF table cannot reference other entries from [env] tables in the same or other EDF files (e.g. the ones entered as base environments) . Therefore, only environment variables from the host or image can be referenced.</li>
</ul>
</li>
<li><em>Environment Variable Resolution Order</em>. The environment variables are resolved based on the following order:<ul>
<li>TOML env: Variable values as defined in EDF’s env.</li>
<li>Container Image: Variables defined in the container image's environment take precedence.</li>
<li>Host Environment: Environment variables defined in the host system.</li>
</ul>
</li>
</ul>
<h3 id="relative-paths-expansion">Relative paths expansion<a class="headerlink" href="#relative-paths-expansion" title="Permanent link">&para;</a></h3>
<p>Relative filesystem paths can be used within EDF parameters, and will be expanded by the CE at runtime. The paths are interpreted as relative to the working directory of the process calling the CE, not to the location of the EDF file.</p>
<h2 id="known-issues">Known Issues<a class="headerlink" href="#known-issues" title="Permanent link">&para;</a></h2>
<h3 id="compatibility-with-alpine-linux">Compatibility with Alpine Linux<a class="headerlink" href="#compatibility-with-alpine-linux" title="Permanent link">&para;</a></h3>
<p>Alpine Linux is incompatible with some hooks, causing errors when used with Slurm. For example,</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>&gt;<span class="w"> </span>cat<span class="w"> </span>alpine.toml
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;alpine: *19&quot;</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>-lN1<span class="w"> </span>--environment<span class="o">=</span>alpine.toml<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;abc&quot;</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="m">0</span>:<span class="w"> </span>slurmstepd:<span class="w"> </span>error:<span class="w"> </span>pyxis:<span class="w"> </span>container<span class="w"> </span>start<span class="w"> </span>failed<span class="w"> </span>with<span class="w"> </span>error<span class="w"> </span>code:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="m">0</span>:<span class="w"> </span>slurmstepd:<span class="w"> </span>error:<span class="w"> </span>pyxis:<span class="w"> </span>printing<span class="w"> </span>enroot<span class="w"> </span>log<span class="w"> </span>file:
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="m">0</span>:<span class="w"> </span>slurmstepd:<span class="w"> </span>error:<span class="w"> </span>pyxis:<span class="w">     </span><span class="o">[</span>ERROR<span class="o">]</span><span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>refresh<span class="w"> </span>the<span class="w"> </span>dynamic<span class="w"> </span>linker<span class="w"> </span>cache
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="m">0</span>:<span class="w"> </span>slurmstepd:<span class="w"> </span>error:<span class="w"> </span>pyxis:<span class="w">     </span><span class="o">[</span>ERROR<span class="o">]</span><span class="w"> </span>/etc/enroot/hooks.d/87-slurm.sh<span class="w"> </span>exited<span class="w"> </span>with<span class="w"> </span><span class="k">return</span><span class="w"> </span>code<span class="w"> </span><span class="m">1</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="m">0</span>:<span class="w"> </span>slurmstepd:<span class="w"> </span>error:<span class="w"> </span>pyxis:<span class="w"> </span>couldn<span class="err">&#39;</span>t<span class="w"> </span>start<span class="w"> </span>container
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="m">0</span>:<span class="w"> </span>slurmstepd:<span class="w"> </span>error:<span class="w"> </span>spank:<span class="w"> </span>required<span class="w"> </span>plugin<span class="w"> </span>spank_pyxis.so:<span class="w"> </span>task_init<span class="o">()</span><span class="w"> </span>failed<span class="w"> </span>with<span class="w"> </span><span class="nv">rc</span><span class="o">=</span>-1
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="m">0</span>:<span class="w"> </span>slurmstepd:<span class="w"> </span>error:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>invoke<span class="w"> </span>spank<span class="w"> </span>plugin<span class="w"> </span>stack
</span></code></pre></div>
<p>This is because some hooks (e.g., Slurm and CXI hooks) leverage <code>ldconfig</code> (from Glibc) when they bind-mount host libraries inside containers; since Alpine Linux provides an alternative <code>ldconfig</code> (from Musl Libc), it does not work as intended by hooks. As a workaround, users may disable problematic hooks. For example,</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>&gt;<span class="w"> </span>cat<span class="w"> </span>alpine_workaround.toml
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="nv">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;alpine: *19&quot;</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="o">[</span>annotations<span class="o">]</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>com.hooks.slurm.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;false&quot;</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>com.hooks.cxi.enabled<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;false&quot;</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>&gt;<span class="w"> </span>srun<span class="w"> </span>-lN1<span class="w"> </span>--environment<span class="o">=</span>alpine_workaround.toml<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;abc&quot;</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>abc
</span></code></pre></div>
<p>Notice the section <code>[annotations]</code> disabling Slurm and CXI hooks.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.action.edit", "navigation.indexes", "search.share", "navigation.instant", "navigation.tracking", "navigation.path", "navigation.top", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>